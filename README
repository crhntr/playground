#!/usr/bin/env bash

# Playground

####
#### Hello! I am building a Go playground mostly using Go with few external tools.
#### Both the front and back end are written in Go and the user code will be run in the client browser.
####

## Setup Dependencies
function init() {
    go mod download
    mkdir -p cmd/webapp/assets
    cp "$(go env GOROOT)/misc/wasm/wasm_exec.js" cmd/webapp/assets/
}

## Build Webapp Assets
function build_webapp() {
  cd cmd/server || exit 1
    ### Remove existing assets directory and copy over webapp code
    rm -rf webapp && cp -rf ../webapp .

    ### Build Webapp (written in Go using WASM)
    GOOS=js GOARCH=wasm go build -o webapp/assets/main.wasm ../webapp/
 cd - || exit 1
}

## Run
function run() {
  build_webapp
  go run ./cmd/server
}

## Any of the functions in this file can be invoked like:
### ./README run
if [ $# -ne 0 ]; then
    "$1"
fi